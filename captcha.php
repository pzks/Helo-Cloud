<?php
session_start();
$code="";
$image=imagecreatetruecolor(100,30);//新建一个真彩色图像，默认输出黑色背景
$color=imagecolorallocatealpha($image,255,255,255,30);//为照片创建白色透明度为30的照片
imagefill($image,0,0,$color);//照片填充为$color的颜色
for($i=0;$i<4;$i++){
    $fontSize=8;
    $fontColor=imagecolorallocate($image,rand(0,120),rand(0,120),rand(0,120));
    $data="asdfghjklqwertyuipzxcvbnm123456789";
    $fontContent=substr($data,rand(0,strlen($data)),1);
    $code.=$fontContent;
    $x=($i*100/4)+rand(0,9);
    $y=rand(5,10);
    imagestring($image,$fontSize,$x,$y,$fontContent,$fontColor);//水平地画一行字符串
}
$_SESSION['code']=$code;//保存生成的验证码

for($i=0;$i<200;$i++){
    $pointColor=imagecolorallocate($image,rand(100,220),rand(100,220),rand(100,220));
    imagesetpixel($image,rand(0,98),rand(1,29),$pointColor);// 画一个单一像素
}
for($i=0;$i<3;$i++){
    $lineColor=imagecolorallocate($image,rand(50,150),rand(50,150),rand(50,150));
    imageline($image,rand(1,99),rand(1,29),rand(1,99),rand(1,29),$lineColor);//画一条线段
}
header('Content-type:image/png');
imagepng($image);//输出照片
imagedestroy($image);//销毁照片